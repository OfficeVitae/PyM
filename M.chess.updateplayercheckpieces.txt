; updatePlayerCheckPieces() updates the check pieces of player #pl
kingrow=piecepositions(pl,1,2) ; the row of the player's King
kingcol=piecepositions(pl,1,3) ; the column of the player's King
; out("king position player #",pl,': ',kingrow,'=',rows(kingrow),' ',kingcol,'=',cols(kingcol),lf)
; from what positions can pawns capture the king?
krow=kingrow+if(pl==1,1,-1)
if(krow>0&&krow<9,(if(kingcol>1,checkpieces(pl,krow,kingcol-1)+='p'),
	if(kingcol<8,checkpieces(pl,krow,kingcol+1)+='p')))

; from what positions can knights capture the king?
kps=((kingrow-1,kingcol-2),(kingrow-2,kingcol-1),(kingrow+1,kingcol-2),(kingrow+2,kingcol-1),(kingrow-1,kingcol+2),(kingrow-2,kingcol+1),(kingrow+1,kingcol+2),(kingrow+2,kingcol+1)) ; the knight positions
for(kpi,1..len(kps),kp=kps(kpi),if(kp(1)>0&&kp(1)<9&&kp(2)>0&&kp(2)<9,checkpieces(pl,kp(1),kp(2))+='N'))

; from what positions can rooks capture the king?
; we have to move in 4 directions until we bump into the border or a piece
; 'down'
krow=kingrow-1
while(krow>0&&board(krow,kingcol)==0,checkpieces(pl,krow,kingcol)+='RQ',krow-=1)
if(krow>0,checkpieces(pl,krow,kingcol)+='RQ')
; 'up'
krow=kingrow+1
while(krow<8&&board(krow,kingcol)==0,checkpieces(pl,krow,kingcol)+='RQ',krow+=1)
if(krow<9,checkpieces(pl,krow,kingcol)+='RQ')
' left'
kcol=kingcol-1
while(kcol>0&&board(kingrow,kcol)==0,checkpieces(pl,kingrow,kcol)+='RQ',kcol-=1)
if(kcol>0,checkpieces(pl,kingrow,kcol)+='RQ')
; 'right'
kcol=kingcol+1
while(kcol<8&&board(kingrow,kcol)==0,checkpieces(pl,kingrow,kcol)+='RQ',kcol+=1)
if(kcol<9,checkpieces(pl,kingrow,kcol)+='RQ')
; from what positions can bishops capture the king?
; 'down' and 'left'
(krow=kingrow-1,kcol=kingcol-1)
while(krow>0&&kcol>0&&board(krow,kcol)==0,checkpieces(pl,krow,kcol)+='BQ',krow-=1,kcol-=1)
if(krow>0&&kcol>0,checkpieces(pl,krow,kcol)+='BQ')
; 'up' and 'right'
(krow=kingrow+1,kcol=kingcol+1)
while(krow<9&&kcol<9&&board(krow,kcol)==0,checkpieces(pl,krow,kcol)+='BQ',krow+=1,kcol+=1)
if(krow<9&&kcol<9,checkpieces(pl,krow,kcol)+='BQ')
; 'down' and 'right'
(krow=kingrow-1,kcol=kingcol+1)
while(krow>0&&kcol<9&&board(krow,kcol)==0,checkpieces(pl,krow,kcol)+='BQ',krow-=1,kcol+=1)
if(krow>0&&kcol<9,checkpieces(pl,krow,kcol)+='BQ')
; 'up' and 'left'
(krow=kingrow+1,kcol=kingcol-1)
while(krow<9&&kcol>0&&board(krow,kcol)==0,checkpieces(pl,krow,kcol)+='BQ',krow+=1,kcol-=1)
if(krow<9&&kcol>0,checkpieces(pl,krow,kcol)+='BQ')