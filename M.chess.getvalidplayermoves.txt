; getValidPlayerMoves() determines all valid moves for each piece of player #pl
; NOTE passing whether or not the king moved before, or is in check as castling flag
;      to getValidKingMoves()
$=?
pps=piecepositions(pl)
for(ppi,1..len(pps),pieceinfo=pps(ppi),
  piecetype=pieceinfo(1),piecerow=pieceinfo(2),piececol=pieceinfo(3),out(ppi,'=',piecetype,lf)
  select(piecetype
    ,$.=?
    ,$.=join(getValidPawnMoves(piecerow,piececol,pieceinfo(4),enpassantcols(3-pl)),2)
    ,$.=join(getValidRookMoves(piecerow,piececol),2)
    ,$.=join(getValidKnightMoves(piecerow,piececol),2)
    ,$.=join(getValidBishopMoves(piecerow,piececol),2)
    ,$.=join(getValidQueenMoves(piecerow,piececol),2)
    ,$.=join(getValidKingMoves(pl,piecerow,piececol,and(pieceinfo(4)==0,len(incheckinfo(pl))==0)),2)
    )
  )
